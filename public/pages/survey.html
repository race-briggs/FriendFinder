<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Friend Finder</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/style.css">
</head>

<body>
  <div class="container">
    <div class="jumbotron">
      <h1>Friend Finder Survey</h1>
      <h2>Answer the questions to get matched with a friend!</h2>
    </div>
  </div>
  <form class="survey-form">
    <div class="question">
      <h3>What is your name?</h3><input type="text" class="name-form" required="true">
    </div>
    <div class="question">
      <h3>Give us a Pic!</h3><input type="text" class="img-form" required="true">
    </div>
    <div class="question1 question">
      <h3>Question 1: You like to eat sweets.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q1" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q1" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q1" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q1" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q1" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question2 question">
      <h3>Question 2: You enjoy the outdoors.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q2" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q2" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q2" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q2" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q2" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question3 question">
      <h3>Question 3: You like to exercise.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q3" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q3" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q3" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q3" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q3" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question4 question">
      <h3>Question 4: You prefer going out to staying in.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q4" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q4" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q4" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q4" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q4" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question5 question">
      <h3>Question 5: You like to watch anime.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q5" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q5" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q5" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q5" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q5" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question6 question">
      <h3>Question 6: You like to drink alcohol</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q6" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q6" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q6" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q6" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q6" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question7 question">
      <h3>Question 7: You consider yourself quiet or shy.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q7" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q7" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q7" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q7" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q7" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question8 question">
      <h3>Question 8: You prefer comedy movies over horror.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q8" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q8" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q8" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q8" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q8" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question9 question">
      <h3>Question 9: You consider yourself a giving person.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q9" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q9" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q9" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q9" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q9" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <div class="question10 question">
      <h3>Question 10: You are busy on the weekend.</h3>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q10" value="1">
        <label class="form-check-label">Strongly Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q10" value="2">
        <label class="form-check-label">Disagree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q10" value="3">
        <label class="form-check-label">Neutral</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q10" value="4">
        <label class="form-check-label">Agree</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="q10" value="5">
        <label class="form-check-label">Strongly Agree</label>
      </div>
    </div>
    <button type="submit" class="btn btn-lg btn-primary" id="submit-btn">Submit</button>
  </form>
  <script>
    var newFriendArray = [];
    var loner;

    $('#submit-btn').on('click', function(event){
      event.preventDefault();

      var friend = {
        name: $('.name-form').val(),
        image: $('.img-form').val(),
        q1: parseInt($('.question1').find('input:checked').val()),
        q2: parseInt($('.question2').find('input:checked').val()),
        q3: parseInt($('.question3').find('input:checked').val()),
        q4: parseInt($('.question4').find('input:checked').val()),
        q5: parseInt($('.question5').find('input:checked').val()),
        q6: parseInt($('.question6').find('input:checked').val()),
        q7: parseInt($('.question7').find('input:checked').val()),
        q8: parseInt($('.question8').find('input:checked').val()),
        q9: parseInt($('.question9').find('input:checked').val()),
        q10: parseInt($('.question10').find('input:checked').val())
      }

      loner = friend;

      // database post call
      // $.ajax('/api/survey', {
      //   data: friend,
      //   type: 'POST'
      // }).then(function (response) {
      //   console.log(response);
      //   findFriend(newFriendArray, loner);
      // })

      $.post('/api/friends', friend, function(){
        console.log("let's get you some friends...");
        getList();
      })

      $('.name-form').val("");
      $('.img-form').val("");

    })

    function getList(){
      // database get call
      // $.ajax('/api/survey', {
      //   type: "GET"
      // }).then(function (response) {
      //   for (var i = 0; i < response.length; i++) {
      //     friendArray.push(response[i]);
      //   }
      //   console.log(friendArray);
      // })

      $.ajax('/api/friends', {
        type: "GET"
      }).then(function(response){
        console.log('Getting Friends...')
        // for(var i = 0; i < response.length; i++){
        //   friendArray.push(response[i]);
        // }
        newFriendArray = response;
        findFriend(newFriendArray, loner);
      })
    }

    function findFriend(array, loner){
      var currentFriendshipCoefficient = 0;
      var leadingScore = 10;
      var bestfriend = {};
      console.log(array);
      console.log(loner);
      for(var i = 0; i < array.length; i++){
        //Absolute value for database query
        // currentFriendshipCoefficient = (Math.abs(loner.q1 - array[i].question1) + Math.abs(loner.q2 - array[i].question2) + Math.abs(loner.q3 - array[i].question3) + Math.abs(loner.q4 - array[i].question4) + Math.abs(loner.q5 - array[i].question5) + Math.abs(loner.q6 - array[i].question6) + Math.abs(loner.q7 - array[i].question7) + Math.abs(loner.q8 - array[i].question8) + Math.abs(loner.q9 - array[i].question9) + Math.abs(loner.q10 - array[i].question10));

        currentFriendshipCoefficient = (Math.abs(loner.q1 - array[i].q1) + Math.abs(loner.q2 - array[i].q2) + Math.abs(loner.q3 - array[i].q3) + Math.abs(loner.q4 - array[i].q4) + Math.abs(loner.q5 - array[i].q5) + Math.abs(loner.q6 - array[i].q6) + Math.abs(loner.q7 - array[i].q7) + Math.abs(loner.q8 - array[i].q8) + Math.abs(loner.q9 - array[i].q9) + Math.abs(loner.q10 - array[i].q10));

        console.log(currentFriendshipCoefficient);

        if(currentFriendshipCoefficient <= leadingScore){
          leadingScore = currentFriendshipCoefficient;
          if(array[i].name !== loner.name){
            bestfriend = array[i];
          }
        }
      }
      console.log(bestfriend);
      displayFriend(bestfriend);
    }

    function displayFriend(bestie){
      Swal.fire({
        title: "Here is your new friend! It's "+ bestie.name,
        imageUrl: bestie.image,
        imageWidth: 400,
        imageHeight: 200,
        imageAlt: 'friendly image'
      });
    }

  </script>
</body>

</html>